<!DOCTYPE html>
<!-- Tagline: Halaman lupa password Caffora dengan request OTP via email dan alert inline tanpa reload. -->
<html lang="id">
  <!-- Atur bahasa dokumen HTML ke bahasa Indonesia -->
  <head>
    <!-- Bagian head untuk meta, title, font, dan CSS inline -->
    <meta charset="utf-8" />
    <!-- Set encoding karakter ke UTF-8 -->
    <title>Caffora â€” Lupa Password</title>
    <!-- Judul halaman di tab browser -->
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Supaya tampilan responsif di mobile -->

    <!-- Fonts -->
    <!-- Komentar: bagian untuk memuat font eksternal -->
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <!-- Import font Poppins dari Google Fonts dengan beberapa ketebalan -->

    <style>
      :root {
        /* Definisi variabel warna utama tema Caffora */
        --gold: #ffd54f; /* Kuning emas lembut untuk aksen utama */
        --gold-deep: #f9b923; /* Kuning lebih pekat untuk gradasi tombol */
        --brown: #4b3f36; /* Coklat kopi sebagai warna teks utama */
        --ink: #2e2823; /* Warna teks lebih gelap (tinta) */
        --muted: #8b8179; /* Warna teks sekunder yang redup */
        --line: #e5e7eb; /* Warna garis/border abu muda */
      }

      * {
        box-sizing: border-box; /* Hitung padding+border di dalam width/height elemen */
      }

      body {
        margin: 0; /* Hilangkan margin default body */
        min-height: 100vh; /* Tinggi minimal 1 layar penuh */
        font-family: "Poppins", sans-serif; /* Gunakan font Poppins untuk keseluruhan halaman */
        background: #ffffff; /* Latar belakang putih bersih */
        color: var(--brown); /* Warna teks default coklat */
        display: flex; /* Pakai flexbox untuk pusatkan konten */
        align-items: center; /* Vertikal center */
        justify-content: center; /* Horizontal center */
      }

      .page-wrap {
        width: 100%; /* Lebar penuh di mobile */
        max-width: 420px; /* Batas lebar konten agar tampak rapi di desktop */
        padding: 24px 20px 32px; /* Spasi di sekeliling konten */
      }

      .field-label {
        font-size: 0.9rem; /* Ukuran label sedikit kecil */
        font-weight: 500; /* Semi-bold untuk label */
        color: var(--ink); /* Warna label lebih pekat */
        margin-bottom: 6px; /* Jarak bawah label ke input */
      }

      .input-email {
        width: 100%; /* Input memenuhi lebar kontainer */
        border-radius: 15px; /* Sudut input melengkung */
        border: 1px solid var(--line); /* Garis border abu lembut */
        padding: 11px 16px; /* Spasi dalam input */
        font-size: 0.9rem; /* Ukuran teks input */
        outline: none; /* Hilangkan outline default browser */
        margin-top: 5px; /* Jarak atas terhadap label */
        transition: border-color 0.15s ease; /* Animasi halus saat border berubah */
      }

      .input-email:focus {
        border-color: var(
          --gold
        ); /* Sorot border dengan warna emas saat fokus */
      }

      .btn-primary {
        margin-top: 16px; /* Jarak tombol dari input di atasnya */
        width: 100%; /* Tombol selebar kontainer */
        border: none; /* Hilangkan border default */
        border-radius: 12px; /* Sudut tombol melengkung */
        padding: 11px 22px; /* Spasi dalam tombol */
        font-size: 0.95rem; /* Ukuran teks tombol sedikit lebih besar */
        font-weight: 600; /* Tebal untuk tekankan aksi utama */
        cursor: pointer; /* Ubah kursor menjadi pointer saat hover */
        background: linear-gradient(
          135deg,
          var(--gold),
          var(--gold-deep)
        ); /* Gradasi emas untuk tombol */
        color: var(--brown); /* Teks tombol warna coklat */
      }

      .btn-primary:disabled {
        opacity: 0.8; /* Sedikit transparan saat disabled */
        cursor: wait; /* Tanda proses berjalan */
        box-shadow: none; /* Tanpa bayangan saat disabled */
      }

      .helper-row {
        margin-top: 16px; /* Jarak dari elemen di atas */
        font-size: 0.85rem; /* Ukuran teks bantuan lebih kecil */
        text-align: center; /* Teks rata tengah */
        color: var(--brown); /* Warna teks sama seperti utama */
      }

      .helper-row a {
        color: #0000ff; /* Link biru untuk aksen (login) */
        font-weight: 500; /* Sedikit ditebalkan agar tampak jelas */
        text-decoration: none; /* Hilangkan garis bawah default */
      }

      .helper-row a:hover {
        text-decoration: underline; /* Tambah underline saat hover untuk feedback */
      }

      /* ALERT SIMPEL BUAT DI BAWAH FORM */
      .alert-box {
        font-size: 0.82rem; /* Teks alert sedikit lebih kecil dari teks biasa */
        color: var(--ink); /* Warna dasar teks alert */
        padding: 6px 2px; /* Spasi atas-bawah kecil */
        margin-top: 12px; /* Jarak dari form di atasnya */
        display: none; /* Disembunyikan secara default */
        opacity: 0; /* Opasitas 0 untuk transisi */
        transition: opacity 0.25s ease; /* Animasi fade-in/out */
      }

      .alert-box.show {
        display: block; /* Tampilkan alert saat punya class show */
        opacity: 1; /* Set opasitas penuh */
      }

      .alert-error {
        color: #a91919; /* Warna merah untuk pesan error */
      }

      .alert-success {
        color: #157f45; /* Warna hijau untuk pesan sukses */
      }
    </style>
  </head>

  <body>
    <!-- Mulai body: tampilan utama halaman -->
    <main class="page-wrap">
      <!-- Container utama konten form lupa password -->
      <!-- Form -->
      <form id="forgotForm" autocomplete="off" novalidate>
        <!-- Form kirim email untuk OTP, tanpa auto-complete & tanpa validasi HTML5 default -->
        <label for="email" class="field-label">Email terdaftar</label>
        <!-- Label untuk input email -->
        <input
          type="email"
          id="email"
          name="email"
          class="input-email"
          placeholder="nama@email.com"
          required
        />
        <!-- Input email dengan placeholder dan wajib diisi -->

        <button type="submit" id="btnSubmit" class="btn-primary">
          Kirim kode OTP
        </button>
        <!-- Tombol submit untuk memicu pengiriman kode OTP -->
      </form>

      <!-- ALERT pindah ke bawah form -->
      <div id="alertBox" class="alert-box"></div>
      <!-- Kontainer pesan feedback (sukses/error) di bawah form -->

      <div class="helper-row">
        Ingat kata sandi?
        <!-- Teks bantuan jika user ternyata ingat password -->
        <a href="login.html">login</a>
        <!-- Link menuju halaman login -->
      </div>
    </main>

    <script>
      <!-- Mulai script untuk logika lupa password -->
      const form = document.getElementById("forgotForm"); // Ambil elemen form berdasarkan id
      const alertBox = document.getElementById("alertBox"); // Ambil elemen box alert untuk pesan status
      const btnSubmit = document.getElementById("btnSubmit"); // Ambil tombol submit untuk di-disable/enable

      function showAlert(message, type = "") {
        // Fungsi untuk menampilkan alert dengan pesan dan tipe (success/error)
        alertBox.className = "alert-box show"; // Reset class ke alert-box + show (untuk tampil & efek fade)
        if (type === "success") alertBox.classList.add("alert-success");
        // Jika success, tambahkan warna hijau
        else if (type === "error") alertBox.classList.add("alert-error"); // Jika error, tambahkan warna merah

        alertBox.textContent = message; // Isi teks alert dengan pesan yang diberikan
      }

      function hideAlert() {
        // Fungsi untuk menyembunyikan alert
        alertBox.className = "alert-box"; // Kembalikan class ke default (tanpa show, tanpa warna)
        alertBox.textContent = ""; // Bersihkan teks pesan
      }

      form.addEventListener("submit", async (e) => {
        // Listener submit form untuk menangani pengiriman tanpa reload
        e.preventDefault(); // Cegah submit bawaan browser (page reload)
        hideAlert(); // Sembunyikan alert lama sebelum menampilkan yang baru

        const email = document.getElementById("email").value.trim(); // Ambil dan trim value email dari input
        if (!email) {
          // Jika email kosong
          showAlert("Email tidak boleh kosong.", "error"); // Tampilkan pesan error bahwa email wajib diisi
          return; // Hentikan eksekusi fungsi
        }

        btnSubmit.disabled = true; // Disable tombol submit agar tidak diklik berulang
        btnSubmit.textContent = "Mengirim kode OTP..."; // Ubah teks tombol jadi status proses

        try {
          // Mulai blok try untuk request ke server
          const res = await fetch("backend/auth_forgot.php", {
            // Kirim request POST ke endpoint backend lupa password
            method: "POST", // Metode HTTP POST
            headers: {
              "Content-Type": "application/json", // Kirim data dengan format JSON
              Accept: "application/json", // Minta respon dalam bentuk JSON
            },
            body: JSON.stringify({ email }), // Kirim payload { email: <alamat email> }
          });

          const raw = await res.text(); // Baca respon sebagai teks mentah (antisipasi kalau bukan JSON bersih)
          let data = {}; // Siapkan objek data default kosong
          try {
            data = JSON.parse(raw); // Coba parse teks ke JSON
          } catch {
            showAlert(
              "Terjadi kesalahan pada server (response tidak valid).",
              "error"
            ); // Jika gagal parse, tampilkan pesan bahwa respon server tidak valid
            return; // Hentikan eksekusi fungsi
          }

          if (data.status === "success") {
            // Jika backend mengembalikan status sukses
            showAlert(
              "Kode OTP reset password sudah dikirim ke email Anda. Silakan cek inbox / spam.",
              "success"
            ); // Tampilkan pesan hijau bahwa OTP sudah dikirim

            setTimeout(() => {
              // Setelah delay singkat, redirect ke halaman reset password
              window.location.href =
                "reset_password.html?email=" + encodeURIComponent(email); // Arahkan ke halaman reset dengan query email
            }, 1200); // Delay 1,2 detik agar user sempat melihat pesan
          } else {
            // Jika status bukan success
            showAlert(
              data.message ||
                "Terjadi kesalahan pada server saat mengirim OTP.",
              "error"
            ); // Tampilkan pesan error custom dari server atau fallback umum
          }
        } catch {
          // Jika request fetch gagal (jaringan / server down)
          showAlert(
            "Terjadi kesalahan pada server (gagal terhubung).",
            "error"
          ); // Tampilkan pesan gagal koneksi
        } finally {
          // Blok yang selalu jalan di akhir (baik sukses maupun gagal)
          btnSubmit.disabled = false; // Re-enable tombol submit agar bisa dipakai lagi
          btnSubmit.textContent = "Kirim kode OTP"; // Kembalikan teks tombol ke semula
        }
      });
    </script>
  </body>
</html>
